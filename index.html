<!doctypehtml>  <head> <title>Outvoice</title> <meta charset=utf-8> <link href=data:image/x-icon;base64,AAABAAEAEBAQAAEABAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAA////AN3V1QDo4+MA/4CAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADMiIiIiMwADNERERERDMAMkIiIiIkIwAyQyMjIyQjADJBMTExNCMAMkMTExMUIwAyQRERERQjADJBMTExNCMAMkEREREUIwAyQxMTIyQjADJBERRERDMAMkERFBFCMwAyQREUFCMzADJBERRCMzMAM0RERCMzMwADMiIjMzMwDAAwAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAADAAwAA rel=icon type=image/x-icon> <link href=https://outvoicegithubio-2neeimtex.now.sh rel=dns-prefetch id=api> <style>*{user-select:none}html{padding:0 8px;background-color:#e2e2e8;color:#5959a5}a,body,input,pre,textarea{font-family:'SF Mono',Monaco,Inconsolata,'Fira Mono','Droid Sans Mono','Source Code Pro',monospace}h1,h2,h3{font-family:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol'}h1{font-size:70px;text-align:center;color:#b7b7e0;font-style:italic;letter-spacing:-2px;position:fixed;bottom:0;width:100%}h1 span{color:#c6c6d1;font-weight:100;letter-spacing:0}h2{position:relative}h2:after{content:'';width:calc(100% - 24px);height:16px;z-index:-1;background-color:#d4d4dc;position:absolute;top:55%;left:12px}h3{font-size:16px;font-variant:small-caps;letter-spacing:2px;margin-bottom:4px}b{color:#000}a{color:#2626d8;text-decoration:none}a:focus,a:hover{text-decoration:underline}li:before{content:'> '}ul{list-style-type:none;padding-left:1em;margin-top:4px}hr{height:0;border:none}label{margin-right:16px}input[type=number]{width:6ch}input{color:#000;background-color:#efefff}button,input{padding:6px 8px;font-size:16px;border:3px solid #d4d4dc;border-radius:5px}button{color:#000;border-color:#d4d4dc;background-color:#d4d4dc;font-weight:700;letter-spacing:1px;line-height:17px}pre,textarea{font-size:16px;width:80ch;top:0;color:#000;cursor:text;padding:2ch;border-width:0;overflow:hidden}textarea{opacity:0;height:calc(100% - 4ch);background-color:#fff;position:absolute;resize:none;box-shadow:10px 7px 20px 12px rgba(0,0,0,.04),-10px 7px 20px 12px rgba(0,0,0,.04),0 4px 13px 4px rgba(0,0,0,.2)}pre{background-color:rgba(255,255,255,.75);box-shadow:5px 5px 10px 6px rgba(0,0,0,.03),-5px 5px 10px 6px rgba(0,0,0,.03),0 2px 6px 3px rgba(0,0,0,.1)}#invoice-wrapper{position:relative}#content{width:672px;width:84ch;margin:0 auto;opacity:0;transition:opacity .5s ease}#info{width:80ch;margin:0 auto}button:hover,input:hover{border-color:#000}textarea:active,textarea:focus,textarea:hover{opacity:1}input:focus{background-color:#f9f9ff}button:focus{color:#7f7fff}button:focus,input:focus{border-color:#7f7fff;outline:0}button:active,input:active{border-color:#00f}button:active{color:#00f}.hide-shortcuts b{color:inherit;font-weight:inherit}.display-mode,.display-mode *{box-shadow:none!important;background:#fff}.display-mode *{display:none;user-select:text}#content,#invoice-wrapper,.display-mode pre,body{display:block!important}@media print{*{display:none}*{box-shadow:none!important;background:#fff}#content,#invoice-wrapper,body,html,pre{display:block!important}}@supports (-moz-appearance:none){textarea{top:-1px}}</style> </head> <body> <h1>Outvoice<span>.github.io</span></h1> <div id=content> <div style=display:flex> <div> <h2>Inputs</h2> <h3>Items</h3> <label> <span><b>d</b>escription</span> <input id=description style=width:38ch maxlength=37> </label> <hr> <label> <span><b>p</b>rice</span> <input id=price type=number max=9999999 min=0> </label> <label> <span><b>q</b>ty</span> <input id=qty type=number max=9999 min=0> </label> <label style=margin-right:0> <span><b>v</b>at</span> <input id=vat type=number max=99 min=0> </label> <button id=add> + </button> <h3>D<b>a</b>te</h3> <label> <input id=date type=date> </label> <label> <span>due <b>i</b>n</span> <input id=due type=number max=999 min=0> days </label> </div> <div style=flex-grow:1> <h2>Outputs</h2> <h3>Save As</h3> <ul> <li><a id=save-text download=file.txt>te<b>x</b>t</a></li> <li><a id=save-pdf download=file.pdf>pd<b>f</b></a></li> </ul> <h3>Copy As</h3> <ul> <li><a id=copy-text href=#><b>t</b>ext</a></li> <li><a id=copy-link-short href=#><b>s</b>hort-link</a> <i>*</i></li> <li><a id=copy-link href=#>data-<b>l</b>ink</a> <i>long</i></li> <li><a id=copy-link-edit href=#>data-lin<b>k</b></a> <i>editable</i></li> </ul> </div> </div> <div id=invoice-wrapper> <textarea id=invoice-text tabindex=1></textarea> <pre id=invoice></pre> </div> </div> <div id=info> <span id=link-short-detail>short-link:</span> <span> by using the this option you allow us to keep your data (in clear) and accept that <code>outvoice.github.io</code> provide 0 garanties of availability of the data. </span> </div> <script>const getById=e=>document.getElementById(e),makeFile=(e,t,a)=>{const n=new File([e],`outvoice.${t}`,{type:a});return URL.createObjectURL(n)},replacer=(e,t)=>(t=>a=>a.replace(e,t))(e=>t[e]),urlSafeEncode=replacer(/[+\/=]/g,{"+":"-","/":"_","=":"."}),urlSafeDecode=replacer(/[-_.]/g,{"-":"+",_:"/",".":"="}),pdfEscape=replacer(/[()\\]/g,{"(":"\\(","\\":"\\\\",")":"\\)"}),encodeData=e=>urlSafeEncode(btoa(JSON.stringify(e))),decodeData=e=>JSON.parse(atob(urlSafeDecode(e))),toPDF=e=>`%PDF-1.5\n1 0 obj <</Type /Catalog /Pages 2 0 R>> endobj\n2 0 obj <</Type /Pages /Kids [3 0 R] /Count 1>> endobj\n3 0 obj <</Type /Page /Parent 2 0 R /Resources 4 0 R /MediaBox [0 0 595 842] /Contents 6 0 R>> endobj\n4 0 obj <</Font <</F1 5 0 R>>>> endobj\n5 0 obj <</Type /Font /Subtype /Type1 /BaseFont /Courier New, Courier>> endobj\n6 0 obj <</Length 7680>> stream\n  BT\n  /F1 11 Tf\n  26 795 Td\n  18 TL\n  ${e.split("\n").map((e,t)=>`(${pdfEscape(e)}) ${t?"'":"Tj"}`).join("\n  ")}\n  ET\nendstream endobj\n\nxref\n0 7\n0000000000 65535 f\n0000000009 00000 n\n0000000059 00000 n\n0000000116 00000 n\n0000000219 00000 n\n0000000259 00000 n\n0000000328 00000 n\n\ntrailer <</Size 7/Root 1 0 R>>\n\nstartxref\n454\n%%EOF`,idb=(()=>{const e=new Promise((e,t)=>{const a=window.indexedDB.open("use-idb",1);a.onerror=(()=>t(a.error)),a.onsuccess=(()=>e(a.result)),a.onupgradeneeded=(()=>a.result.createObjectStore("idb"))}),t=async(t,a,...n)=>{const o=(await e).transaction("idb",t),r=o.objectStore("idb");return new Promise((e,t)=>{const i=r[a](...n);o.oncomplete=(()=>e(i)),o.onabort=o.onerror=(()=>t(o.error))})};return{get:async e=>(await t("readonly","get",e)).result,set:(e,a)=>void 0===a?t("readwrite","delete",e):t("readwrite","put",a,e)}})(),handlers={get:e=>e.value,set:(e,t)=>e.value=t,parse:e=>e,compare:(e,t)=>e===t,compareRaw:(e,t)=>e===t,persist:!0,INPUTnumber:{get:e=>e.valueAsNumber,set:(e,t)=>e.valueAsNumber=Number(t)},INPUTdate:{compare:(e,t)=>e&&t&&e.getTime()===t.getTime(),compareRaw:(e,t)=>e&&t&&e.getTime()===t.getTime(),get:e=>e.valueAsDate,set:(e,t)=>e.valueAsDate=new Date(t)}},events=new Set,loop=()=>{for(const e of events)e();setTimeout(()=>requestAnimationFrame(loop))},exec=(e,t)=>{try{for(const a of e)a(t)}catch(e){console.error("Unhandled:",e.stack)}},stated=(e,t,a)=>{const n=getById(e),{get:o,set:r,persist:i,parse:s,compare:c,compareRaw:d}={...handlers,...handlers[n.tagName+n.type],...a},l=new Set,p=new Set;let u,m,v,g,S;const y=e=>c(e,u)?e:v=e;events.add(()=>{const t=document.activeElement===n;if(t){const t=o(n);if(null===t)return;if(!d(g,t))try{y(s(t,u)),m=!1,g=t}catch(a){return console.log("failed to parse new input value for state",e),console.log(t),console.warn(a.stack),m=!0,r(n,u),void setTimeout(exec,0,p,a)}}else if(S)return S=!1,r(n,u),void setTimeout(exec,0,l,u);m||void 0!==v&&(u=v,v=void 0,setTimeout(exec,0,l,u),t?S=!0:r(n,u),i&&idb.set(e,u).catch(console.error))});const f=i?idb.get(e).then(e=>y(e||t)):Promise.resolve().then(()=>y(t));return{elem:n,then:f.then.bind(f),catch:f.catch.bind(f),set:e=>y(e),reset:()=>y(t),getRaw:()=>g,get:()=>u,once:(e,t)=>t=l.delete(a=>t(e(a))),sub:(e,t)=>("function"==typeof e&&l.add(e),"function"==typeof t&&p.add(t),()=>{l.delete(e),p.delete(t)})}},hyperLink=(e,t)=>{const a=getById(e);let n;const o=async e=>{n&&(a.href=await t(),n=void 0)};return a.addEventListener("mouseenter",o,{passive:!0}),a.open=(e=>{o(),a.dispatchEvent(new MouseEvent("click",{ctrlKey:e,metaKey:e}))}),()=>n=!0},PADS={description:37,subtotal:9,total:22,price:8,qty:4,vat:4,no:3},padAll=e=>Object.keys(e).map(t=>Number(e[t])==e[t]?String(e[t]).padStart(PADS[t]||0," "):` ${String(e[t]).padEnd(PADS[t]-1||0," ")}`),getTotalExcl=e=>`(excl tax) ${Math.ceil(e.reduce((e,{price:t,qty:a})=>t*a+e,0))}`.padStart(PADS.total," "),getTotalVat=e=>`+ ${e.reduce((e,{price:t,qty:a,vat:n})=>t*(n/100)*a+e,0).toFixed(2)}`.padStart(PADS.total," "),getTotalIncl=e=>`(incl tax): ${e.reduce((e,{price:t,qty:a,vat:n})=>(t+t*(n/100))*a+e,0).toFixed(2)} EURO`.padEnd(36," "),getList=e=>e.map(({description:e,price:t=0,qty:a=1,vat:n=0},o)=>padAll({no:String(o+1).padStart(2,"0"),description:e,price:`${t}`,qty:a,vat:n,subtotal:`${t*a}`}).join(" |")).map(e=>`  |${e} |`).join("\n"),formatInvoiceFixed=({header:e,separator:t,body:a,items:n,due:o,date:r})=>[e,formatDate(r),t,formatDate(r,o),a,`\n        -----------------------------------------------------------------------\n       | DESCRIPTION                          |  PRICE  | QTY | VAT | SUBTOTAL |\n   ............................................................................|\n${getList(n)}\n   -------------------------------------------|................................|\n                                              |         ${getTotalExcl(n)} |\n> TOTAL ${getTotalIncl(n)}  |         ${getTotalVat(n)} |\n                                               --------------------------------\n`].join(""),trim=e=>e.trim(),pad2=e=>String(e).padStart(2,"0"),getId=e=>{const t=pad2(e.getMonth()+1),a=e.getFullYear();return[t,a,String(localStorage[t+a]||1).padStart(3,"0")].join("-")},formatDate=(e,t=0)=>{const a=new Date(e.getFullYear(),e.getMonth(),e.getDate()+t);return[a.getDate(),a.getMonth()+1,a.getFullYear()].map(pad2).join("/")},parseItemLine=e=>{const t=e.split("|").map(trim).filter(Boolean);return{description:t[1],price:Number(t[2]),qty:Number(t[3]),vat:Number(t[4])}},parseInvoiceText=(e,t)=>{const[,a,n,o,r]=e.split(/([^]*?)\d+\/\d+\/\d+([^]*?)\d+\/\d+\/\d+([^]*?)\n.+\n.+\| DESCRIPTION.+ \|\n.+([^]*?)\n   -/);return{...t,header:a,separator:n,body:o,items:r.trim().split("\n").filter(trim).map(parseItemLine)}};let loadId,urlData={};try{const e=new URLSearchParams(window.location.search);if(loadId=e.get("id"),e.get("data")){(urlData=decodeData(e.get("data"))).date=new Date(urlData.date);const t=e.has("edit");urlData.persistance={override:t,persist:t},t||document.documentElement.classList.add("display-mode")}}catch(e){console.log("Error loading url",window.location.search),console.log(e)}const persistance=urlData.persistance||{persist:!0},defaultDate=urlData.date||new Date,apiURL=getById("api").href,invoicePre=getById("invoice"),addButton=getById("add"),descriptionState=stated("description",urlData.description||"Software Development"),priceState=stated("price",urlData.price||400),qtyState=stated("qty",urlData.qty||1),vatState=stated("vat",urlData.vat||"0"),dueState=stated("due",urlData.due||7,persistance),dateState=stated("date",defaultDate,{persist:!1}),invoiceState=stated("invoice-text",{header:`# Invoice ${getId(defaultDate)}\n\nCreated `,date:defaultDate,separator:" - Due ",due:urlData.due||7,body:"\n\n> FROM\n  NAME     Clark Kent\n  ADDRESS  66 rue Wonder Woman - 99000 Metropolis - FRANCE\n  EMAIL    email@gmail.com\n  PHONE    +33601020304\n  SIRET    88776655400000\n  IBAN     FR76167980000000000000000000\n  BIC      TRZOFR21XXX\n\n> BILLED TO\n  NAME     SUPERMAN INC\n  ADDRESS  66 rue Wonder Woman - 99000 Metropolis - FRANCE\n  EMAIL    superman@dc.comics\n  VAT      101010101\n\n",items:[{description:"Software Development",price:400,qty:1,vat:0},{description:"Some License",price:27,qty:3,vat:20}],...urlData},{...persistance,parse:parseInvoiceText,set:(e,t)=>e.value=formatInvoiceFixed(t)}),states=[descriptionState,priceState,qtyState,vatState,dateState,dueState,invoiceState],textarea=invoiceState.elem,selections=[...states.slice(0,4),addButton,...states.slice(4)].map(e=>e.elem||e),inputs=selections.filter(e=>e!==addButton),isFocused=e=>document.activeElement===e,baseUrl=`${window.location.origin}${window.location.pathname}`,copy=()=>navigator.clipboard.writeText(textarea.value),addItem=()=>invoiceState.set({...invoiceState.get(),items:[...invoiceState.get().items,{description:descriptionState.get(),price:priceState.get(),qty:qtyState.get(),vat:vatState.get()}]});invoiceState.sub(hyperLink("save-text",()=>makeFile(textarea.value,"txt","plain/text"))),invoiceState.sub(hyperLink("save-pdf",()=>makeFile(toPDF(textarea.value),"pdf","application/pdf"))),invoiceState.sub(hyperLink("copy-link",()=>`${baseUrl}?data=${encodeData(invoiceState.get())}`)),invoiceState.sub(hyperLink("copy-link-short",async()=>{const e=await fetch(apiURL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(invoiceState.get())}),{data:t,error:a}=await e.json();if(a)return console.error("Error while getting link:",a);t.id}));const regenEditLink=hyperLink("copy-link-edit",()=>`${baseUrl}?edit&data=${encodeData({description:descriptionState.get(),price:priceState.get(),qty:qtyState.get(),vat:vatState.get(),...invoiceState.get()})}`);invoiceState.sub(regenEditLink),qtyState.sub(regenEditLink),vatState.sub(regenEditLink),priceState.sub(regenEditLink),descriptionState.sub(regenEditLink),invoiceState.sub(()=>invoicePre.textContent=textarea.value),dueState.sub(e=>invoiceState.set({...invoiceState.get(),due:e})),dateState.sub(e=>invoiceState.set({...invoiceState.get(),date:e})),addButton.addEventListener("click",addItem),events.add(()=>{const e=!document.hasFocus()||inputs.some(isFocused);document.body.classList.toggle("hide-shortcuts",e)}),Promise.all(states.map(e=>e.catch(t=>(console.error("Error loading state",e.id,t.stack),e.reset()))).concat(loadId&&fetch(`${apiURL}${loadId}`).then(async e=>{const{data:t,error:a}=e.json();return a?console.error("unable to load id",loadId,a):invoiceState.set(t)}))).then(loop).then(()=>getById("content").style.opacity=1);const eventOpen=e=>t=>e.open(t.shiftKey),eventSelect=e=>t=>{e.focus(),t.shiftKey&&e.select()},selectors={enter:()=>{document.activeElement===addButton&&addItem(),inputs[0].focus()},d:eventSelect(descriptionState.elem),p:eventSelect(priceState.elem),q:eventSelect(qtyState.elem),v:eventSelect(vatState.elem),a:eventSelect(dateState.elem),i:eventSelect(dueState.elem),n:eventSelect(textarea),"+":addItem,"=":addItem,x:eventOpen(getById("save-text")),f:eventOpen(getById("save-pdf")),l:eventOpen(getById("copy-link")),s:eventOpen(getById("copy-link-save")),k:eventOpen(getById("copy-link-edit")),t:copy},getLineAt=(e,t)=>("\n"===e[t]&&t--,{start:e.lastIndexOf("\n",t),end:e.indexOf("\n",t)});textarea.addEventListener("paste",e=>{if(textarea.selectionStart!==textarea.selectionEnd)return;const t=e.clipboardData.getData("text");if("\n"!==t[0]||-1!==t.indexOf("\n",1))return;e.preventDefault();const a=textarea.value,n=textarea.selectionEnd,{start:o}=getLineAt(a,n);textarea.setSelectionRange(o,o),document.execCommand("insertText",!1,t);const r=a.indexOf("\n",n),i=Math.min(r,n+t.length);textarea.setSelectionRange(i,i)}),textarea.addEventListener("copy",e=>{if(textarea.selectionStart!==textarea.selectionEnd)return;e.preventDefault();const t=textarea.value,{start:a,end:n}=getLineAt(t,textarea.selectionEnd),o=a===n?"\n":t.slice(a,n);e.clipboardData.setData("text/plain",o)}),textarea.addEventListener("cut",e=>{if(textarea.selectionStart!==textarea.selectionEnd)return;e.preventDefault();const t=textarea.selectionEnd,{start:a,end:n}=getLineAt(textarea.value,t);textarea.setSelectionRange(a,a===n?n+1:n),document.execCommand("cut"),textarea.setSelectionRange(t,t)}),addEventListener("keydown",e=>{const t=e.key.toLowerCase(),a=e.ctrlKey||e.metaKey;if(inputs.some(isFocused))switch(t){case"enter":if(document.activeElement===textarea)return requestAnimationFrame(()=>invoiceState.elem.scrollTop=0);e.preventDefault();const a=selections.indexOf(document.activeElement)+(e.shiftKey?-1:1),n=a<0?selections.length-1:a%selections.length;return selections[n].focus();case"escape":return document.activeElement.blur&&document.activeElement.blur()}else{if(a){if("s"===t)e.preventDefault(),selectors.x(e);else if("a"===t){if(!e.metaKey&&!e.ctrlKey)return;if(document.documentElement.classList.contains("display-mode"))return;e.preventDefault(),textarea.select()}return}selectors[t]&&!1!==selectors[t](e)&&e.preventDefault()}}),addEventListener("wheel",e=>{"INPUT"===e.target.tagName&&e.target!==document.activeElement&&e.target.focus()});</script> 